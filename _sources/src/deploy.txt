Deployment
==========

Deploy ``felapps`` to different operating systems is quite simple, both 
online and offline approaches are provided. Before installing this package
into system, there may be packages/libraries dependence issues to be
resolved first.

Prerequisites
-------------

Required Python packages: ``numpy``, ``scipy``, ``matplotlib``, 
``pyepics``, ``h5py``, ``pyrpn``, ``beamline``, ``lmfit``, ``wxPython``.

Packages with version information:

.. code-block:: rest

    numpy      : 1.11.1
    scipy      : 0.17.1
    matplotlib : 1.5.1
    pyepics    : 3.2.6
    h5py       : 2.6.0
    pyrpn      : 1.0.3
    beamline   : 1.3.5
    lmfit      : 0.9.3
    wxPython   : 3.0.2.0

.. note::
    
    * ``wxPython`` should be built with unicode support
    * Install them by ``pip install <package_name>`` (recommanded)

Installation
------------

**Online approach**

.. code-block:: bash
    
    pip install felapps --prefix=/opt/high-level-apps -i https://pypi.python.org/pypi
    
or precisely define the version number:

.. code-block:: bash

    pip install felapps==1.5.13 --prefix=/opt/high-level-apps -i https://pypi.python.org/pypi


**Offline approach**

Download `felapps <https://pypi.python.org/pypi/felapps>`_ from PyPI.

.. code-block:: bash

    pip install felapps-1.5.13-py2.py3-none-any.whl --prefix=/opt/high-level-apps

.. note::

    * ``root`` privilege may be asked.

Configurations
--------------

**Environmental Variables**

After installing ``felapps``, system-wide environment variables should be 
configured correctly, say save the following shell code to file 
``felapps.sh``, put it into folder: ``/etc/profile.d``, or append them 
into the bash configuration files.

.. code-block:: bash

    HLAPATH=/opt/high-level-apps
    HLAPYLIB=${HLAPATH}/lib/python2.7/site-packages
    HLAPYBIN=${HLAPATH}/bin/
    export PYTHONPATH=${HLAPYLIB}
    export PATH=${PATH}:${HLAPYBIN}

**System-menu Integration**

To integrate the available apps into system menu would greatly improve the
user experience, just like the following image shows [#f1]_: all the apps are
categorized into ``FEL Apps`` menu, through which you can reach differnt
apps to accomplish different tasks.

.. image:: ../images/felapps-menu.png
    :width: 400px

``felapps`` distributes a script called: ``update-felapps-menu`` to handle
the system-menu integration issues, here is the usage:

* Install ``felapps`` into system-menu:

.. code-block:: python
    
    update-felapps-menu --appdir /opt/high-level-apps/

* Uninstall ``felapps`` from system-menu:   

.. code-block:: python
    
    update-felapps-menu --appdir /opt/high-level-apps/ --operation uninstall

.. warning:: If executing the above command with the ``root`` privilege,
    all the users would see the menu, or only the current user could see
    them.

.. only:: html
    
    .. rubric:: Footnotes:

.. [#f1] The menu screenshot may differ from other operating systems.
