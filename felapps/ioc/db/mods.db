## simulate modulator and chicane
#
record(ai, "$(MACHINE):MODXLAMD:SET")
{
        field(DTYP, "Soft Channel")
        field(VAL,"50")
        field(UDF,1)
        field(PREC, "4")
        field(FLNK, "$(MACHINE):MODXLAMD")
}

record(calc, "$(MACHINE):MODXLAMD")
{
        field(INPA, "$(MACHINE):MODXLAMD:SET")
        field(INPB, "$(MACHINE):NOISE")
	    field(SCAN, "1 second")
        field(PREC, "4")
        field(CALC, "A + A*B")
}

record(ai, "$(MACHINE):CHIFIELD:SET")
{
        field(DTYP, "Soft Channel")
        field(VAL,"0.1")
        field(UDF,1)
        field(PREC, "4")
        field(FLNK, "$(MACHINE):CHIFIELD")
}

record(calc, "$(MACHINE):CHIFIELD")
{
        field(INPA, "$(MACHINE):CHIFIELD:SET")
        field(INPB, "$(MACHINE):NOISE")
	    field(SCAN, "1 second")
        field(PREC, "4")
        field(CALC, "A + A*B")
}

record(ai, "$(MACHINE):MODNUM:SET")
{
        field(DTYP, "Soft Channel")
        field(VAL,"10")
        field(UDF,1)
        field(PREC, "4")
        field(FLNK, "$(MACHINE):MODNUM")
}

record(calc, "$(MACHINE):MODNUM")
{
        field(INPA, "$(MACHINE):MODNUM:SET")
        field(INPB, "$(MACHINE):NOISE")
	    field(SCAN, "1 second")
        field(PREC, "4")
        field(CALC, "A + A*B")
}

record(ai, "$(MACHINE):MODGAP:SET")
{
        field(DTYP, "Soft Channel")
        field(VAL,"10.0")
        field(UDF,1)
        field(PREC, "4")
        field(FLNK, "$(MACHINE):MODGAP")
}

record(calc, "$(MACHINE):MODGAP")
{
        field(INPA, "$(MACHINE):MODGAP:SET")
        field(INPB, "$(MACHINE):NOISE")
	    field(SCAN, "1 second")
        field(PREC, "4")
        field(CALC, "A + A*B")
}

record(calc, "$(MACHINE):SIN")
{
        field(INPA, "$(MACHINE):SIN")
	    field(SCAN,"1 second")
        field(PREC, "4")
        field(CALC, "(A>10?0:A+0.1)")
}
record(calc, "$(MACHINE):NOISE")
{
        field(INPA, "$(MACHINE):SIN")
	    field(SCAN,"1 second")
        field(PREC, "4")
        field(CALC, "(SIN(A)+COS(A))*0.00")
}

## waveform record for diag radiation
record(waveform, "$(MACHINE):DIAG:PROF:ARR")
{
    field(DESC, "Image data 121x121")
    field(NELM, "14641")
    field(SCAN, "1 second")
    field(FTVL, "DOUBLE")
}

record(ai, "$(MACHINE):DIAG:PROF:INT:SET")
{
    field(DTYP, "Soft Channel")
    field(VAL,"0")
    field(UDF,1)
    field(PREC, "4")
    field(FLNK, "$(MACHINE):DIAG:PROF:INT")
}
record(calc, "$(MACHINE):DIAG:PROF:INT")
{
        field(INPA, "$(MACHINE):DIAG:PROF:INT:SET")
        field(INPB, "$(MACHINE):NOISE")
	    field(SCAN, "1 second")
        field(PREC, "4")
        field(CALC, "A + A*B")
}
