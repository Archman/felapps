# virtual profile image
record(waveform, "$(PREFIX):PROF19:ARR")
{
    field(DESC, "Image data 659x494")
    field(NELM, "325546")
    field(SCAN, ".1 second")
    field(FTVL, "UCHAR")
}

# image intensity (set by external program)
record(ai, "$(PREFIX):PROF19:INT:SET")
{
        field(DTYP, "Soft Channel")
        field(VAL,0)
        field(UDF,1)
        field(PREC, "4")
        field(FLNK, "$(PREFIX):PROF19:INT")
}

record(calc, "$(PREFIX):PROF19:INT")
{
        field(INPA, "$(PREFIX):PROF19:SET:INT")
        field(INPB, "$(PREFIX):NOISE")
	    field(SCAN, ".1 second")
        field(PREC, "4")
        field(CALC, "A + A*B")
}

# noise record from ding
record(calc, "$(PREFIX):SIN")
{
        field(INPA, "$(PREFIX):SIN")
	    field(SCAN, ".1 second")
        field(PREC, "4")
        field(CALC, "A>10?0:A+0.1")
}
record(calc, "$(PREFIX):NOISE")
{
        field(INPA, "$(PREFIX):SIN")
	    field(SCAN,".1 second")
        field(PREC, "4")
        field(CALC, "(SIN(A)+COS(A))*0.003")
}

# fake ai record to control intensity
record(ai, "$(PREFIX):AMP:SET")
{
    field(DTYP, "Soft Channel")
    field(VAL, "100")
    field(UDF, 1)
    field(PREC, "4")
    field(FLNK, "$(PREFIX):AMP")
}

record(calc, "$(PREFIX):AMP")
{
    field(INPA, "$(PREFIX):AMP:SET")
    field(INPB, "$(PREFIX):NOISE")
    field(SCAN, ".1 second")
    field(PREC, "4")
    field(CALC, "A*(1+B*2)")
}

